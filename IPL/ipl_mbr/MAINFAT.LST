Turbo Assembler	 Version 3.1	    17/03/18 19:46:46	    Page 1
mainfat.asm



      1					 ;
      2					 ; Extended Operating System Loader (XOSL)
      3					 ; Copyright (c) 1999 by Geurt Vos
      4					 ;
      5					 ; This	code is	distributed under GNU General Public License (GPL)
      6					 ;
      7					 ; The full text of the	license	can be found in	the GPL.TXT file,
      8					 ; or at http://www.gnu.org
      9					 ;
     10
     11					 ;/*
     12					 ; * File  : MAIN.ASM
     13					 ; * Author: Geurt Vos
     14					 ; * Date  : March 1999
     15					 ; *
     16					 ; * Main routine for either FAT IPL
     17					 ; */
     18
     19	    0000					 .model	 tiny
     20							 .386p
     21	    0000					 .data
     22		  =80000100		 LOADERADDR	 equ	 80000100h
     23		  =8000			 LOADERSEG	 equ	 8000h
     24
     25	    0000					 .data
     26							 extrn	 LoaderName: near
     27
     28	    0000					 .code
     29							 extrn	 ReadFile: near
     30
     31							 .startup
1    32						 ORG	 100h
1    33	    0100			 @Startup:
     34	    0100  EA					 db	 0eah		 ;jmp 07b0:0105
     35	    0101  07B00105				 dd	 07b00105h
     36					 ;07b0:0105:
     37	    0105  B8 07B0				 mov	 ax,07b0h
     38	    0108  8E D8					 mov	 ds,ax
     39	    010A  8E D0					 mov	 ss,ax
     40	    010C  BC FFFE				 mov	 sp,0fffeh
     41
     42
     43	    010F  66| 68 80000100			 push	 LOADERADDR
     44	    0115  1E					 push	 ds
     45	    0116  68 0000e				 push	 offset	LoaderName
     46	    0119  E8 0000e				 call	 ReadFile
     47	    011C  0B C0					 or	 ax,ax		 ;ax ==	0 if success
     48	    011E  74 15	90 90				 jz	 RunLoader
     49	    0122  32 E4					 xor	 ah,ah
     50	    0124  CD 16					 int	 16h		 ;wait for keypress
     51
     52	    0126  33 C0					 xor	 ax,ax		 ;reboot
     53	    0128  8E D8					 mov	 ds,ax
     54	    012A  C7 06	0472 1234			 mov	 ds:word ptr [0472h],1234h
     55	    0130  EA					 db	 0eah		 ;jmp f000:fff0
     56	    0131  F000FFF0				 dd	 0f000fff0h
     57
Turbo Assembler	 Version 3.1	    17/03/18 19:46:46	    Page 2
mainfat.asm



     58
     59	    0135  B8 8000		 RunLoader:	 mov	 ax,LOADERSEG
     60	    0138  8E D8					 mov	 ds,ax
     61	    013A  8E D0					 mov	 ss,ax
     62	    013C  BC FFFE				 mov	 sp,0fffeh
     63
     64	    013F  EA					 db	 0eah		 ;execute com file
     65	    0140  80000100				 dd	 LOADERADDR
     66
     67							 end
1    68						 END @Startup
Turbo Assembler	 Version 3.1	    17/03/18 19:46:46	    Page 3
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "17/03/18"
??FILENAME			  Text	 "mainfat "
??TIME				  Text	 "19:46:46"
??VERSION			  Number 030A
@32BIT				  Text	 0
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0F8FH
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 MAINFAT
@INTERFACE			  Text	 00H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@STARTUP			  Near	 DGROUP:0100
@WORDSIZE			  Text	 2
LOADERADDR			  Number 80000100
LOADERNAME (LoaderName)		  Near	 DGROUP:---- Extern
LOADERSEG			  Number 8000
READFILE (ReadFile)		  Near	 DGROUP:---- Extern
RUNLOADER			  Near	 DGROUP:0135

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0000 Word	  Public  DATA
  _TEXT				  16  0144 Word	  Public  CODE
